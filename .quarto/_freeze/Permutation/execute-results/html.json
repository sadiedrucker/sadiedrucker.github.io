{
  "hash": "a1951a3a4444dde99a78e01ac837ee2f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Bill length in male vs female penguins\"\nformat: \n  html:\n    code-fold: true\n    \nexecute:\n  message: false\n  warning: false\n  echo: true\n---\n\n\n\n\n## Background\n\nThis simulation study investigates whether there is a statistically significant difference in bill length between male and female penguins, testing the alternative hypothesis that bill length varies by sex. he analysis uses data from the *palmerpenguins* dataset in R, which contains morphological measurements for three penguin species from the Palmer Archipelago in Antarctica. Understanding differences in bill length across sexes can provide insights into sexual dimorphism and ecological adaptations in penguin species. A permutation test was conducted to simulate the distribution of mean differences under the null hypothesis that bill length is independent of sex, allowing for an assessment of whether the observed difference is more likely due to random chance.\n\n## Visualization of variables of interest\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\nlibrary(ggplot2)\n\nclean_penguins <- penguins |>\n  filter(!is.na(bill_length_mm), !is.na(sex))\n\nggplot(clean_penguins, aes(x=sex, y=bill_length_mm, fill=sex))+\n  geom_boxplot()+\n    labs(\n      title = \"Bill length in male vs female penguins\" , \n      x= \"Sex\",\n      y= \"Bill length in mm\"\n      )+\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Permutation_files/figure-html/unnamed-chunk-1-1.png){fig-alt='A boxplot comparing bill length between male and female penguins in the sample. Male penguins show a higher median bill length and a slightly wider spread than females.' width=672}\n:::\n:::\n\n\n\n\nIn the original data presented in the above graph, male penguins have a greater median bill length. To reject the null hypothesis, we performed a permutation test to determine whether this observed difference between sexes is likely to have occurred by chance.\n\n## Permutation Test\n\n### Step 1: Define the null hypothesis\n\nIn this case, the null hypothesis is that bill length is independent of sex in penguins.\n\n### Step 3: Permute (shuffle) the variable labels\n\nThis forces the null hypothesis to be true.\n\n### Step 3: Compute the observed test statistic on the null sampling distribution.\n\nWe do this by computing the mean and median differences between the sexes. I created a function called *`perm_data()`*. This function keeps track of the current replication number, *rep*, and the data set containing *`sex`* and *`bill_length_mm.`*The function mutates the data set to add a column called *`sex_perm.`* that randomly shuffles the sex labels. This action simulates the null hypothesis.\n\nThe mapping function quickly tests if the function is working as expected.\n\n## \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Permutation test \n\nset.seed(47) \n\nperm_data <- function(rep, data){\n  data |> \n    select(sex, bill_length_mm) |> \n    mutate(sex_perm = sample(sex, replace = FALSE)) |>\n    summarize(\n      obs_ave_diff = mean(bill_length_mm[sex == \"male\"], na.rm = TRUE) - \n                     mean(bill_length_mm[sex == \"female\"], na.rm = TRUE),\n      obs_median_diff = median(bill_length_mm[sex == \"male\"], na.rm = TRUE) - \n                        median(bill_length_mm[sex == \"female\"], na.rm = TRUE),\n      perm_ave_diff = mean(bill_length_mm[sex_perm == \"male\"], na.rm = TRUE) - \n                      mean(bill_length_mm[sex_perm == \"female\"], na.rm = TRUE),\n      perm_median_diff = median(bill_length_mm[sex_perm == \"male\"], na.rm = TRUE) - \n                         median(bill_length_mm[sex_perm == \"female\"], na.rm = TRUE),\n              rep = rep)\n}\n  \nmap(c(1:10), perm_data, data = clean_penguins) |> \n  list_rbind()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 5\n   obs_ave_diff obs_median_diff perm_ave_diff perm_median_diff   rep\n          <dbl>           <dbl>         <dbl>            <dbl> <int>\n 1         3.76               4        -0.245            1.60      1\n 2         3.76               4        -1.33            -2.55      2\n 3         3.76               4        -0.396           -0.950     3\n 4         3.76               4         0.634            1.80      4\n 5         3.76               4         0.288            1.75      5\n 6         3.76               4        -0.102           -0.850     6\n 7         3.76               4         0.340            1.05      7\n 8         3.76               4        -0.933           -2.6       8\n 9         3.76               4        -0.383           -1.85      9\n10         3.76               4        -0.643           -1.30     10\n```\n\n\n:::\n:::\n\n\n\n\n### Step 4: Visualize null sampling distributions\n\nThe mapping function used here runs the function *`perm_data()`* one thousand times to simulate the permutation distribution.\n\nEach row in *`perm_stats`* represents one shuffled permutation: the permuted mean and median differences and the observed statistics.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(47)\nperm_stats <- \n  map(c(1:1000), perm_data, data = clean_penguins) |> \n  list_rbind() \n\nperm_stats |> \n  ggplot(aes(x = perm_ave_diff)) + \n  geom_histogram() + \n  geom_vline(aes(xintercept = obs_ave_diff), color = \"red\")+\n  labs(\n    title=\"Mean null sampling distributions \"\n  )\n```\n\n::: {.cell-output-display}\n![](Permutation_files/figure-html/unnamed-chunk-3-1.png){fig-alt='A histogram showing the permutation-based null distribution of mean bill-length differences between sexes, centered around zero. A vertical red line marks the observed mean difference from the sample, which lies far outside of most of the distribution.' width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n\"A histogram showing the permutation-based null distribution of median bill-length differences between sexes, centered around zero. A vertical red line marks the observed median difference from the sample, which is at the tail end of the distribution.\"\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"A histogram showing the permutation-based null distribution of median bill-length differences between sexes, centered around zero. A vertical red line marks the observed median difference from the sample, which is at the tail end of the distribution.\"\n```\n\n\n:::\n\n```{.r .cell-code}\nperm_stats |> \n  ggplot(aes(x = perm_median_diff)) + \n  geom_histogram() + \n  geom_vline(aes(xintercept = obs_median_diff), color = \"red\")+\n   labs(\n    title=\"Median null sampling distributions \"\n  )\n```\n\n::: {.cell-output-display}\n![](Permutation_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n### Step 5: Compute the p-value\n\nThis value indicates the probability of observing the data or more extreme outcomes if the null hypothesis is true. In other words, the probability that the pattern in the original observed data is due to random chance.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n perm_stats |> \n  summarize(\n    p_val_ave = (sum(abs(perm_ave_diff) >= abs(obs_ave_diff[1])) + 1) / (n() + 1),\n    p_val_median = (sum(abs(perm_median_diff) >= abs(obs_median_diff[1])) + 1) / (n() + 1)\n  ) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  p_val_ave p_val_median\n      <dbl>        <dbl>\n1  0.000999     0.000999\n```\n\n\n:::\n:::\n\n\n\n\n## Conclusion\n\nThe permutation test provides strong evidence that male and female penguins have different bill lengths. Both the mean and median differences are far outside the distribution expected under the null hypothesis of no difference. The extremely small p-values (p ≈ 0.001) indicate that the observed differences are highly unlikely to have occurred by random chance, confirming significant sexual dimorphism in bill length.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}